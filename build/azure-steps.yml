
steps:
- task: NodeTool@0
  inputs:
    versionSpec: $(node_version)
  displayName: 'Install Node.js'

- script: 'npm install -g yarn'
  displayName: 'Install yarn'
- script: 'yarn install && yarn run install-all:task:windows'
  displayName: 'Install deps'
- script: 'yarn build-all'
  displayName: 'Build all'
# - script: 'node lighthouse-cli http://example.com'
#   displayName: 'Just run the damn thang'
# - script: 'yarn smoke'
#   displayName: 'Smoketests'
- script: 'yarn lint'
  displayName: 'Lint'
  continueOnError: true
- script: 'yarn unit-core:ci'
  displayName: 'Run unit tests'
  continueOnError: true
# - script: 'npx jest --ci --reporters=default --reporters=jest-junit "lighthouse-core/"'
- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '*.junit.xml'


# - script: 'yarn type-check'
#   displayName: 'Type check'
#   continueOnError: true
# - script: 'yarn diff:sample-json'
#   displayName: 'Diff the goldens'
#   continueOnError: true
# - script: 'yarn i18n:checks'
#   displayName: 'Do the i18n checks'
#   continueOnError: true
