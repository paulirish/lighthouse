# Workflow that only runs when a commit lands on master.

name: üë∑‚Äç‚ôÄÔ∏è

on:
  push:
    branches:
      - master
  # running on PRs disabled until we can disable the comments. https://github.com/paularmstrong/build-tracker-action/issues/3
  # pull_request:

jobs:
  buildtracker:

    runs-on: ubuntu-latest

    steps:
    - name: git clone
      uses: actions/checkout@v2

    - name: Use Node.js 10.x
      uses: actions/setup-node@v1
      with:
        node-version: 10.x

    - run: yarn --frozen-lockfile
    - run: yarn build-all

    - name: Store in buildtracker
      run: yarn bt-cli upload-build
      env:
        # https://buildtracker.dev/docs/guides/github-actions#configuration
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BT_API_AUTH_TOKEN: ${{ secrets.BT_API_AUTH_TOKEN }}
